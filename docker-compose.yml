version: '3.8'

services:
  # 프론트엔드 (Vite Dev Server)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: spica-skill-frontend
    ports:
      - "${VITE_PORT:-3000}:3000"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - VITE_PORT=${VITE_PORT:-3000}
      - VITE_API_PORT=${VITE_API_PORT:-3001}
      - VITE_API_URL=${VITE_API_URL}
    networks:
      - spica-network
    command: npm run dev -- --host 0.0.0.0
    restart: unless-stopped

  # 백엔드 (API Server)
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: spica-skill-backend
    ports:
      - "${API_PORT:-3001}:3001"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - API_PORT=${API_PORT:-3001}
      - LANGFUSE_PUBLIC_KEY=${LANGFUSE_PUBLIC_KEY}
      - LANGFUSE_SECRET_KEY=${LANGFUSE_SECRET_KEY}
      - LANGFUSE_HOST=${LANGFUSE_HOST:-https://cloud.langfuse.com}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    networks:
      - spica-network
    command: npm run server:dev
    restart: unless-stopped
    depends_on:
      - frontend

networks:
  spica-network:
    driver: bridge
